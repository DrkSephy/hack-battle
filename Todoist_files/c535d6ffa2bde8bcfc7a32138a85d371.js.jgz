window.GB_CURRENT=[];window.RELOAD_GB_ON_CLOSE=false;window.GB_SRC_LOADER="/greyBoxLoaderFrame";GB_hide=function(a,b){if(GB_CURRENT.length==0){return false}var c=GB_getLast();if(b!=false&&c.close_validator_fn&&!c.close_validator_fn()){return false}var d=GB_CURRENT.pop();if(!d){return}if(window.LocationManager&&window.LocationManager.updateLocation&&d.old_hash!=window.location.hash){LocationManager.updateLocation(d.old_hash.replace("#",""))}d.hide(a);var c=GB_getLast();if(c){c.overlay.style.zIndex=c.cur_zindex-5}_GB_setOverlayDimension();return false};GB_getLast=function(){return $last(GB_CURRENT)};GreyBox=new Class({init:function(c){if(window.LocationManager){this.old_hash=window.LocationManager.getHash()}else{this.old_hash=window.location.hash}this.type="page";this.overlay_click_close=false;this.salt=0;this.callback_fns=[];this.cur_zindex=10000;this.customLeft_fn=c.customLeft_fn;this.customTop_fn=c.customTop_fn;this.src_loader=GB_SRC_LOADER;this.show_overlay=true;this.overlay_transparent=false;var b=window.location.hostname.indexOf("www");var a=this.src_loader.indexOf("www");if(b!=-1&&a==-1){this.src_loader=this.src_loader.replace("://","://www.")}if(b==-1&&a!=-1){this.src_loader=this.src_loader.replace("://www.","://")}this.show_loading=true;$update(this,c)},addCallback:function(a){if(a){this.callback_fns.push(a)}},show:function(a){if(window.AmiTooltip){window.AmiTooltip.hide()}$map($all("video"),function(c){try{c.pause()}catch(d){}});this.url=a;var b=[$all("object"),$all("iframe")];$map($arrayFlatten(b),function(c){c.style.visibility="hidden"});if(GB_getLast()){this.cur_zindex=GB_getLast().cur_zindex+500}this.createElements();GB_CURRENT.push(this);return false},hide:function(a){var b=this;setTimeout(function(){var c=b.callback_fns;if(c!=[]){$map(c,function(e){$b(e,b)()})}b.onHide();$remove(b.g_window);$remove(b.overlay);if(GB_getLast()==null){$map($all("video"),function(f){try{f.play()}catch(g){}})}b.removeFrame();$REV(window,"scroll",_GB_setOverlayDimension);$REV(window,"resize",_GB_update);var d=[$all("object"),$all("iframe")];$map($arrayFlatten(d),function(e){e.style.visibility="visible"});if(window.GB_UPDATE_LOCATION&&GB_CURRENT.length==0){window.location=GB_UPDATE_LOCATION}if(window.RELOAD_GB_ON_CLOSE&&GB_CURRENT.length==0){window.location.reload()}if($isFunction(a)){a()}},10)},update:function(){this.setOverlayDimension();this.setFrameSize();this.setWindowPosition();if(this.width+50>$winSize().w||$winSize().w<450){$addClass(this.g_window,"full_screen")}else{$removeClass(this.g_window,"full_screen")}},createElements:function(){this.initOverlay();this.g_window=DIV({id:"GB_window",s:"z-index: "+this.cur_zindex,c:"shadow"});$hide(this.g_window);$add($body(),this.g_window);this.initFrame();this.initHook();this.update();var a=this;if(this.overlay.style.opacity!="0.8"){if(!this.show_overlay){$setOpacity(this.overlay,0)}else{$setOpacity(this.overlay,0.8)}}$show(this.g_window);this.onShow();this.startLoading();$AEV(window,"scroll",_GB_setOverlayDimension);$AEV(window,"resize",_GB_update)},removeFrame:function(){try{$remove(this.iframe)}catch(a){}this.iframe=null},startLoading:function(){if(this.iframe){this.iframe.src=this.src_loader+"?s="+this.salt++;$show(this.iframe)}},setOverlayDimension:function(){var a=$winSize();if($isIe()){$setWidth(this.overlay,a.w)}else{$setWidth(this.overlay,"100%")}var b=Math.max($scrollTop()+a.h,$scrollTop()+this.height);if(b<$scrollTop()){$setHeight(this.overlay,b)}else{$setHeight(this.overlay,$scrollTop()+a.h)}},setZindex:function(a){this.cur_zindex=a;this.g_window.style.zIndex=a},initOverlay:function(){this.overlay=DIV({c:"GB_overlay"});if(this.overlay_transparent){$addClass(this.overlay,"overlay_transparent")}this.overlay.style.zIndex=this.cur_zindex-5;if(this.overlay_click_close){this.overlay.onclick=GB_hide}$setOpacity(this.overlay,0);$body().insertBefore(this.overlay,$body().firstChild)},initFrame:function(){if(!this.iframe){var b={name:"GB_frame","class":"GB_frame",frameBorder:0};if($isIe()){b.src='javascript:false;document.write("");'}this.iframe=IFRAME(b);this.middle_cnt=DIV({"class":"content"},this.iframe);this.top_cnt=DIV();this.bottom_cnt=DIV();var a=DIV({c:"GB_Window_holder"});$add(a,this.top_cnt,this.middle_cnt,this.bottom_cnt);$add(this.g_window,a)}},onHide:function(){},onShow:function(){},setFrameSize:function(){},setWindowPosition:function(){},initHook:function(){}});_GB_update=function(){if(GB_getLast()){GB_getLast().update()}};_GB_setOverlayDimension=function(){if(GB_getLast()){GB_getLast().setOverlayDimension()}};GB_showImage=function(c,d,a){var b={width:300,height:300,type:"image",center_win:true,caption:c,callback_fn:a};var e=new GB_Gallery(b);return e.show(d)};GB_Gallery=GreyBox.extend({init:function(a){this.parent({overlay_click_close:true});$update(this,a);this.addCallback(this.callback_fn)},initHook:function(){$addClass(this.g_window,"GB_Gallery");var d=DIV({"class":"inner"});this.header=DIV({"class":"GB_header"},d);var b=TD({id:"GB_caption","class":"caption",width:"40%"},this.caption);var g=TD({id:"GB_middle","class":"middle",width:"20%"});var f=imageSprite("cmp_small_close",16,16);$AEV(f,"click",GB_hide);var e=TD({"class":"close",width:"40%"},f);var c=TBODY(TR(b,g,e));var a=TABLE({cellspacing:"0",cellpadding:0,border:0},c);$add(d,a);$AEV(window,"scroll",$b(this._setHeaderPos,this))},setFrameSize:function(){$setWidth(this.iframe,this.width);$setHeight(this.iframe,this.height)},_setHeaderPos:function(){$setTop(this.header,$scrollTop()+10)},setWindowPosition:function(){var b=this.overlay.offsetWidth;var c=$winSize();$setLeft(this.g_window,((b-50-this.width)/2));var a=$scrollTop()+55;if(!this.center_win){$setTop(this.g_window,a)}else{var d=((c.h-this.height)/2)+20+$scrollTop();if(d<0){d=0}if(a>d){d=a}$setTop(this.g_window,d)}this._setHeaderPos()},onHide:function(){$remove(this.header);$removeClass(this.g_window,"GB_Gallery")},onShow:function(){$setOpacity(this.header,1)}});GB_Window=GreyBox.extend({init:function(a){this.parent({});this.show_close_img=true;$update(this,a);this.addCallback(this.callback_fn)},initHook:function(){$addClass(this.g_window,"GB_Window");this.header=TABLE({"class":"g_header"});var e=TD({"class":"caption"},this.caption);var c=TD({"class":"close"});if(this.show_close_img){var b=imageSprite("cmp_small_close",16,16);var a=SPAN(b);var d=DIV(a);$AEV(d,"mouseover",function(){$addClass(a,"on")});$AEV(d,"mouseout",function(){$removeClass(a,"on")});$AEV(d,"mousedown",function(){$addClass(a,"click")});$AEV(d,"mouseup",function(){$removeClass(a,"click")});$AEV(d,"click",$p(GB_hide,null));$add(c,d)}tbody_header=TBODY();$add(tbody_header,TR(e,c));$add(this.header,tbody_header);$add(this.top_cnt,this.header)},setFrameSize:function(){$setWidth(this.iframe,this.width);$setHeight(this.iframe,this.height)},setWindowPosition:function(){var b=$winSize();if(this.customLeft_fn){this.customLeft_fn(this.g_window,this)}else{$setLeft(this.g_window,((b.w-this.width)/2)-13)}if(this.customTop_fn){this.customTop_fn(this.g_window,this)}else{if(!this.center_win){$setTop(this.g_window,$scrollTop())}else{var a=((b.h-this.height)/2)-20+$scrollTop();if(a<0){a=0}$setTop(this.g_window,a)}}}});$AEV(window,"message",function(e){function b(f){if(e&&e.data.indexOf(f)!=-1){var g=parseInt(e.data.split(".")[1]);return g}return null}var d=GB_getLast();var a=b("greybox_change_height");if(d&&a){d.height=a;d.setFrameSize();d.setWindowPosition()}var c=b("greybox_change_width");if(d&&c){d.width=c;d.setFrameSize();d.setWindowPosition()}});GB_show=window.old_GB_show=function(b,d,a,e,g){var c={caption:b,height:a||500,width:e||500,fullscreen:false,callback_fn:g,use_fx:true,overlay_click_close:true,show_loading:true};var f=new GB_Window(c);return f.show(d)};GB_showFullScreen=function(a,c,e){var b={caption:a,fullscreen:true,use_fx:true,callback_fn:e};var d=new GB_Window(b);return d.show(c)};GB_HTMLWindow=GB_Window.extend({init:function(b,a){this.elm=b;this.parent(a)},initFrame:function(){if(!this.iframe){this.iframe=ICE.DIV(this.elm);$addClass(this.elm,"gb_iframe_html");this.middle_cnt=ICE.DIV({"class":"content"},DIV({c:"iframe_holder"},this.iframe));this.top_cnt=ICE.DIV();this.bottom_cnt=ICE.DIV();var a=ICE.DIV({c:"GB_Window_holder shadow"});$add(a,this.top_cnt,this.middle_cnt,this.bottom_cnt);$setWidth(a,this.width+10);$add(this.g_window,a)}},initOverlay:function(){this.parent()},setFrameSize:function(){var a=this.width;if(window.FLUID_MINI){a+=30}else{a+=12}}});GB_showYouTube=function(f,b,a,c,e){if(!a){a=480}if(!c){c=853}b=b.replace("/watch?v=","/embed/");if(b.indexOf("?")==-1){b=b+"?autoplay=1&vq=hd720&showinfo=0&rel=0&theme=light"}else{b=b+"&autoplay=1&vq=hd720&showinfo=0&rel=0&theme=light"}var g=DIV();$add(g,IFRAME({width:c,height:a,src:b,frameborder:0,allowfullscreen:"allowfullscreen",border:0}));var d=GB_showHTML(f,g,a,c,e);$addClass(d.g_window,"GB_video_player");return d};GB_showViemo=function(g,b,a,d,f){if(!a){a=450}if(!d){d=800}var c=$setHTML(DIV(),'<iframe src="'+b+'?portrait=0&amp;badge=0&amp;color=ffffff&amp;autoplay=1" width="'+d+'" height="'+a+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>');var e=GB_showHTML(g,c,a,d,f);$addClass(e.g_window,"GB_video_player");return false};window.old_GB_showHTML=GB_showHTML=function(b,d,a,e,g){if($winSize().w<450){e=Math.min(e,450)}var c={caption:b,height:a||500,width:e||500,overlay_click_close:true,fullscreen:false,use_fx:true};if(g){$update(c,g)}var f=new GB_HTMLWindow(d,c);f.show();return f};GB_hideIfNeeded=function(a){if(GB_CURRENT.length>0){GB_hide(a)}else{a()}return false};$AEV(document,"keyup",function(b){var a=GB_CURRENT;if(b.keyAscii==27&&a.length>0){if(AmiComplete.shown()){AmiComplete.hide();return false}if(MiniCal.shown()){MiniCal.remove();return false}var c=$eventElm(b);if(c&&c.cancelInput&&c.cancelInput(b)){$preventDefault(b);return false}GB_hide();return false}return true});var new_show=function(b,c,a,d){var e=$winSize().w+50;if(e<450&&e<d){var f=window.open(c,"","height="+a+",width="+d+",scrollbars=yes");if(!f.opener){f.opener=self}}else{window.old_GB_show(b,c,a,d)}return false};window.GB_show=new_show;var GTooptipWin,__bind=function(a,b){return function(){return a.apply(b,arguments)}};GTooptipWin=(function(){function a(){this.show=__bind(this.show,this)}a.prototype.show=function(k,j,m,d,b){var l,n,f,e,i,c,h,g;if(b==null){b=null}if(!b){b={}}g={};l=DIV({c:"GB_top_arrow"},imageSprite("cmp_top_arrow",16,6));g.callback_fn=function(){var o;$remove(l);if(b.fn_on_hide){o=b.fn_on_hide();if(!o){}}};if(b.close_validator_fn){g.close_validator_fn=b.close_validator_fn}n=function(){if(b.fn_arrow_right){$setRight(l,b.fn_arrow_right())}if(b.fn_arrow_left){return $setLeft(l,b.fn_arrow_left())}};i=function(){var o;if(b.fn_on_show){b.fn_on_show()}n();o=function(){return $add($body(),l)};return setTimeout(o,20)};e=function(p,o){if(b.fn_left_offset){$setLeft(p,b.fn_left_offset(p,o))}return n()};g.customLeft_fn=e;if(b.fn_top_offset){c=function(q,p){var o;o=b.fn_top_offset(q,p);$setTop(q,o);return $setTop(l,o-14)};g.customTop_fn=c}g.overlay_transparent=true;h=GB_showHTML(k,j,m,d,g);f=GB_getLast();$addClass(f.g_window,"GB_tooltip_win");l.style.zIndex=(f.cur_zindex||50000)+2;if(b.fixed_pos){$addClass(f.g_window,"GB_fixed_pos");$addClass(l,"GB_top_arrow_fixed")}i();return f};return a})();window.TooptipWin=new GTooptipWin();